{% extends 'base.html' %}
{% load static %}

{% block title %}Perfil de Usuario{% endblock %}
{% block otros_css %}
<link rel="stylesheet" href="{% static 'css/perfil.css' %}">
{% endblock %}

{% block content %}
<div class="perfil-wrapper">
    <div class="perfil-container">
        <!-- Header con avatar y nombre -->
        <div class="perfil-header">
            <div class="avatar-container">
                <div class="avatar-circle">
                    <i class="bi bi-person-fill"></i>
                </div>
                <div class="avatar-badge">
                    {% if profile_user.is_superuser %}
                    <i class="bi bi-star-fill" title="Superusuario"></i>
                    {% elif profile_user.is_staff %}
                    <i class="bi bi-shield-fill-check" title="Staff"></i>
                    {% else %}
                    <i class="bi bi-person-check-fill" title="Usuario"></i>
                    {% endif %}
                </div>
            </div>
            <div class="perfil-header-info">
                <h1 class="perfil-nombre">{{ profile_user.get_full_name|default:profile_user.username }}</h1>
                <div class="perfil-info-wrapper">
                    <p class="perfil-username">@{{ profile_user.username }}</p>
                    {% if usuario_profile.puntuacion_promedio %}
                    <span class="perfil-puntuacion">{{ usuario_profile.puntuacion_promedio }}
                    <i class="bi bi-star-fill rating-star"></i>
                    {% endif %}
                </div>
                {% if profile_user.is_superuser %}
                <span class="perfil-role superuser">Superusuario</span>
                {% elif profile_user.is_staff %}
                <span class="perfil-role staff">Staff</span>
                {% else %}
                <span class="perfil-role user">Usuario</span>
                {% endif %}
            </div>
        </div>

        <!-- Información personal (solo visible para el propio usuario) -->
        {% if es_propio %}
        <div class="perfil-section">
            <h2 class="section-title">
                <i class="bi bi-person-lines-fill"></i>
                Información Personal
            </h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">
                        <i class="bi bi-person"></i>
                        Nombre
                    </div>
                    <div class="info-value">{{ profile_user.first_name|default:"No especificado" }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">
                        <i class="bi bi-person"></i>
                        Apellido
                    </div>
                    <div class="info-value">{{ profile_user.last_name|default:"No especificado" }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">
                        <i class="bi bi-envelope"></i>
                        Email
                    </div>
                    <div class="info-value">{{ profile_user.email|default:"No especificado" }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">
                        <i class="bi bi-calendar-check"></i>
                        Miembro desde
                    </div>
                    <div class="info-value">{{ profile_user.date_joined|date:"d/m/Y" }}</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Estadísticas (si tienes apuntes relacionados) -->
        <div class="perfil-section">
            <h2 class="section-title">
                <i class="bi bi-bar-chart-fill"></i>
                Estadísticas
            </h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="bi bi-file-earmark-text"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value">{{ usuario_profile.apunte_set.count|default:0 }}</div>
                        <div class="stat-label">Apuntes subidos</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="bi bi-star-fill"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value">{{ usuario_profile.puntuacion_set.count|default:0 }}</div>
                        <div class="stat-label">Puntajes dados</div>
                    </div>
                </div>
                <div class="stat-card stat-card-rating">
                    <div class="stat-icon">
                        <i class="bi bi-award-fill"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value">
                            {% if usuario_profile.puntuacion_promedio %}
                            {{ usuario_profile.puntuacion_promedio }}
                            <i class="bi bi-star-fill rating-star"></i>
                            <span class="stat-label">({{ usuario_profile.total_puntuaciones_recibidas }})</span>
                            {% else %}
                            <span class="no-rating">N/A</span>
                            {% endif %}
                        </div>
                        <div class="stat-label">Puntuación</div>
                    </div>
                </div>
            </div>
            <!-- Badge de reputación -->
            {% if usuario_profile.puntuacion_promedio %}
            <div class="reputacion-badge">
                <i class="bi bi-trophy-fill"></i>
                <span class="reputacion-nivel">{{ usuario_profile.nivel_reputacion }}</span>
                <span class="reputacion-detalle">
                    Basado en {{ usuario_profile.total_puntuaciones_recibidas }} puntaje{{usuario_profile.total_puntuaciones_recibidas|pluralize:"s" }}
                </span>
            </div>
            {% endif %}
        </div>

        <!-- Acciones (solo visible para el propio usuario) -->
        {% if es_propio %}
        <div class="perfil-actions">
            <a href="#" class="btn-action btn-primary">
                <i class="bi bi-pencil-square"></i>
                Editar Perfil
            </a>
            <a href="#" class="btn-action btn-secondary">
                <i class="bi bi-key"></i>
                Cambiar Contraseña
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}